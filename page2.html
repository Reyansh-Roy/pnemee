<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Project Nemesis: Psychological Fingerprinting</title>
  <meta name="viewport" content="width=1024, user-scalable=no">
  <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono:700|Oswald:700&display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: linear-gradient(120deg, #090c11 0%, #080a16 90%);
      color: #fff;
      font-family: 'IBM Plex Mono', 'Oswald', monospace;
      overflow: hidden;
      scrollbar-width: none;
      -ms-overflow-style: none;
      user-select: none;
    }
    body::-webkit-scrollbar { display: none; }

    .desktoponly {
      position: fixed;
      inset: 0;
      background: #0a0c16f7;
      z-index: 99999;
      color: #00ffee;
      display: none;
      justify-content: center;
      align-items: center;
      font-size: 2.3rem;
      font-family: Oswald, monospace;
      letter-spacing: 0.09em;
      text-shadow: 0 0 20px #00ffeecc, 0 0 7px #ff0066bb;
      animation: deniedPulse 1.8s infinite alternate;
    }
    @keyframes deniedPulse {
      0% { opacity: 0.97; }
      100% { opacity: 0.8; }
    }

    .matrix-bg {
      position: fixed;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      z-index: 1;
      pointer-events: none;
      opacity: 0.12;
      animation: matrixMove 18s linear infinite;
      overflow: hidden;
    }
    @keyframes matrixMove {
      0% { background-position: 0 0; }
      100% { background-position: 0 100vh; }
    }

    .main-wrap {
      width: 100vw; height: 100vh;
      display: flex;
      flex-direction: row;
      position: relative;
      z-index: 2;
    }
    .left-panel, .right-panel {
      width: 50vw; min-width: 440px;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: none;
      position: relative;
      overflow: hidden;
    }

    /* -- Left Panel: AI Silhouette + Scan -- */
    .ai-col {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      margin-top: -3vh;
      z-index: 5;
      pointer-events: none;
    }
    .ai-label {
      font-size: 1.05rem;
      font-family: Oswald, monospace;
      letter-spacing: 0.16em;
      color: #00ffee;
      margin-bottom: 0.65em;
      text-shadow: 0 0 8px #00ffeeaa;
      text-transform: uppercase;
      font-weight: bold;
      text-align: center;
    }
    .silhouette-wrap {
      position: relative;
      width: 310px; height: 340px;
      filter: blur(0.4px);
      animation: aiFlicker 5.2s infinite alternate;
      pointer-events: none;
      display: flex; align-items: center; justify-content: center;
    }
    @keyframes aiFlicker {
      0%,100% { filter: blur(1.2px) brightness(1.13); }
      10% { filter: blur(0.8px) brightness(1.05); }
      20% { filter: blur(0.4px) brightness(1.18);}
      70% { filter: blur(1.6px) brightness(1.06);}
    }
    .silhouette-img {
      width: 97%;
      height: 97%;
      object-fit: contain;
      filter:
        drop-shadow(0 0 36px #00ffeeee)
        drop-shadow(0 0 18px #ff006655)
        drop-shadow(0 0 6px #fff8);
      opacity: 0.97;
      border-radius: 36px;
      transition: filter 0.28s;
      pointer-events: none;
      animation: glowBreathe 3s infinite alternate;
    }
    @keyframes glowBreathe {
      0% { filter: drop-shadow(0 0 28px #00ffeebb) drop-shadow(0 0 8px #ff006666);}
      70% { filter: drop-shadow(0 0 42px #00ffeeee) drop-shadow(0 0 19px #ff006655);}
      100% { filter: drop-shadow(0 0 35px #00ffeecc) drop-shadow(0 0 11px #ff006688);}
    }
    /* Holographic scanning sweep effect */
    .scan-sweep {
      position: absolute;
      left: 0; top: 0; width: 100%; height: 100%;
      background: linear-gradient(120deg, transparent 60%, #00ffee99 70%, transparent 90%);
      opacity: 0.28;
      pointer-events: none;
      animation: scanSweepAnim 3.5s infinite linear;
      mix-blend-mode: screen;
      filter: blur(7px);
    }
    @keyframes scanSweep {
      0% { transform: translateY(-50%) rotate(0deg);}
      70% { transform: translateY(110%) rotate(2deg);}
      100% { transform: translateY(-50%) rotate(-2deg);}
    }

    /* -- Right Panel: Question + Vulnerability -- */
    .right-content {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
      width: 100%;
      min-width: 420px;
      z-index: 10;
    }
    .question-box {
      margin-bottom: 1.6em;
    }
    .neural-icon {
      width: 32px; height: 32px;
      margin-bottom: -8px; margin-right: 10px;
      filter: drop-shadow(0 0 5px #00ffeecc);
      vertical-align: middle;
    }
    .question-txt {
      font-size: 1.32rem;
      color: #00ffee;
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 700;
      text-shadow: 0 0 8px #00ffee99, 0 0 3px #fff7, 0 0 1px #ff0066aa;
      margin-bottom: 0.4em;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
    }

    /* Ghost input magic */
    .ghost-wrap {
      position: relative;
      width: 410px; max-width: 92vw;
      margin-bottom: 1.25em;
    }
    .user-textarea {
      width: 100%; min-height: 84px; max-height: 200px;
      background: rgba(17,18,24,0.97);
      border: 2.1px solid #00ffee;
      color: #fff;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 1.14rem;
      padding: 1.1em 1.3em;
      border-radius: 15px;
      outline: none;
      resize: none;
      transition: border 0.2s, box-shadow 0.18s;
      box-shadow: 0 0 18px #00ffee33, 0 0 3px #ff006622;
      z-index: 2;
      animation: textareaPulse 3s infinite alternate;
      caret-color: #ff0066;
    }
    .user-textarea:focus {
      border: 2.3px solid #ff0066;
      box-shadow: 0 0 16px #ff0066bb, 0 0 1px #00ffee77;
    }
    @keyframes textareaPulse {
      0% { box-shadow: 0 0 9px #00ffee33, 0 0 3px #ff006633;}
      100% { box-shadow: 0 0 18px #00ffee99, 0 0 7px #ff006666;}
    }
    .ghost-text {
      position: absolute; left: 1.3em; top: 1.15em;
      color: #45dfff;
      opacity: 0.64;
      font-style: italic;
      font-size: 1.13rem;
      pointer-events: none;
      letter-spacing: 0.01em;
      transition: opacity 0.35s;
      z-index: 3;
      filter: blur(0.1px);
      animation: ghostType 2.6s steps(10,end) infinite;
    }
    @keyframes ghostType {
      0% { opacity: 0.09; }
      20% { opacity: 0.7;}
      100% { opacity: 0.5;}
    }
    .ghost-glitch {
      animation: ghostGlitch 0.5s steps(5) 1;
      color: #ff0066;
      text-shadow: 0 0 9px #fff, 0 0 4px #ff0066, 0 0 6px #00ffee;
      opacity: 0.9;
    }
    @keyframes ghostGlitch {
      20% { letter-spacing: 0.18em; transform: skewX(-6deg);}
      45% { color: #ff0066; }
      65% { text-shadow: 0 0 5px #fff, 0 0 13px #ff0066cc; }
      100% { opacity: 0; }
    }
    /* Animated scan sweep on textarea */
    .scanline {
      pointer-events: none;
      position: absolute; left: 0; top: 0;
      width: 100%; height: 100%;
      border-radius: 15px;
      background: linear-gradient(100deg, transparent 65%, #00ffeecc 80%, transparent 100%);
      opacity: 0.15;
      mix-blend-mode: screen;
      animation: scanSweepTextarea 4s linear infinite;
    }
    @keyframes scanSweepTextarea {
      0% { transform: translateY(-100%); }
      85% { transform: translateY(140%); }
      100% { transform: translateY(-100%);}
    }

    /* Finish & Next Button */
    .finish-btn, .next-btn {
      margin-top: 1.4em;
      font-size: 1.2rem;
      background: linear-gradient(90deg, #ff0066 0%, #00ffee 100%);
      color: #fff;
      padding: 0.74em 2.4em;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      font-family: Oswald, 'IBM Plex Mono', monospace;
      font-weight: 600;
      box-shadow: 0 0 16px #00ffee77, 0 0 6px #ff006633;
      text-shadow: 0 0 7px #fff7;
      letter-spacing: 0.09em;
      transition: background 0.19s, box-shadow 0.18s;
      outline: none;
      filter: drop-shadow(0 0 8px #ff006688);
      opacity: 0.93;
      display: inline-block;
      position: relative;
    }
    .finish-btn:active, .next-btn:active {
      background: linear-gradient(90deg, #00ffee 0%, #ff0066 100%);
      box-shadow: 0 0 24px #00ffeecc, 0 0 13px #ff0066aa;
    }
    .finish-btn[disabled] {
      opacity: 0.6; pointer-events: none;
      filter: grayscale(0.8) blur(0.2px);
    }
    /* Loading state */
    .processing-row {
      display: flex; align-items: center;
      margin-top: 1.5em;
      font-size: 1.17rem;
      color: #00ffee;
      gap: 1.3em;
      font-family: 'IBM Plex Mono', monospace;
      letter-spacing: 0.03em;
      text-shadow: 0 0 8px #00ffeecc;
      min-height: 42px;
      min-width: 160px;
    }
    .dots-anim {
      display: inline-block;
      font-size: 2.1em;
      font-family: 'IBM Plex Mono', monospace;
      color: #ff0066;
      letter-spacing: 0.19em;
      animation: dotsAnim 1.2s steps(5) infinite;
      vertical-align: bottom;
    }
    @keyframes dotsAnim {
      0%, 20% { opacity: 0.28; }
      50% { opacity: 1; }
      100% { opacity: 0.28;}
    }
    .cyber-runes {
      font-size: 1.5em;
      letter-spacing: 0.18em;
      color: #00ffee;
      opacity: 0.5;
      animation: runesAnim 0.8s steps(6) infinite alternate;
    }
    @keyframes runesAnim {
      0% { opacity: 0.19;}
      100% { opacity: 0.7;}
    }
    /* Vulnerability reveal */
    .vuln-row {
      margin-top: 2em;
      font-size: 1.11rem;
      min-height: 3em;
      letter-spacing: 0.04em;
      color: #fff;
      opacity: 0;
      transform: scale(0.96) translateY(18px);
      filter: blur(7px);
      animation: none;
      transition: opacity 0.2s, filter 0.22s, transform 0.19s;
      text-shadow: 0 0 10px #00ffee88, 0 0 5px #ff006655;
      font-family: Oswald, 'IBM Plex Mono', monospace;
      font-weight: 700;
    }
    .vuln-row.reveal {
      animation: revealVuln 0.77s cubic-bezier(0.4,2,0.7,1.1) 0s 1 normal forwards;
    }
    @keyframes revealVuln {
      0% { opacity: 0; filter: blur(13px); transform: scale(0.93) translateY(22px);}
      40% { opacity: 0.3; filter: blur(5px);}
      100% { opacity: 1; filter: blur(0); transform: scale(1) translateY(0);}
    }
    .core-title {
      font-size: 1.1rem;
      color: #00ffee;
      letter-spacing: 0.11em;
      font-family: 'IBM Plex Mono', monospace;
      text-shadow: 0 0 7px #ff006655;
      margin-bottom: 0.5em;
      text-transform: uppercase;
      font-weight: 600;
    }
    .core-summary {
      font-size: 1.6rem;
      font-family: Oswald, monospace;
      color: #fff;
      letter-spacing: 0.14em;
      text-shadow: 0 0 15px #00ffeecc, 0 0 7px #ff0066bb;
      font-weight: 800;
      padding: 0.1em 0;
    }
    /* Top Timer Bar */
    .timerbar-wrap {
      position: fixed; top: 0; left: 0;
      width: 100vw; height: 7px;
      background: transparent;
      z-index: 111;
      pointer-events: none;
      overflow: hidden;
    }
    .timerbar-bg {
      position: absolute; top: 0; left: 0;
      width: 100vw; height: 100%;
      background: linear-gradient(90deg, #00ffdd44 0%, #099 50%, #e0195e88 100%);
      opacity: 0.18;
      filter: blur(4px);
      border-bottom: 1px solid #199a;
    }
    .timerbar-fg {
      height: 100%;
      background: linear-gradient(90deg,#24f6,#3ff 10%,#f13f62 80%,#1ad9c3);
      box-shadow: 0 0 12px #28ffe8,0 0 22px #ee275a66;
      border-radius: 4px;
      animation: barwave 2.2s infinite alternate;
      transition: width 0.25s cubic-bezier(.46,1.32,.54,.97);
    }
    @keyframes barwave {
      0% { filter: blur(1px);}
      80% { filter: blur(4px);}
      100% { filter: blur(2.5px);}
    }
    /* Responsive - only show on desktop/tablet (min 900px) */
    @media (max-width: 900px) {
      .main-wrap, .timerbar-wrap, .matrix-bg { display: none !important; }
      .desktoponly { display: flex !important; }
    }
    @media (max-width: 1150px) {
      .main-wrap { min-width: 700px; }
      .left-panel, .right-panel { min-width: 280px; }
      .ghost-wrap, .user-textarea { width: 97%; min-width: 200px;}
    }
  </style>
</head>
<body>
  <div class="desktoponly">Access Denied<br>Desktop/Tablet Only</div>
  <!-- Subtle matrix effect background -->
  <canvas class="matrix-bg" id="matrixbg"></canvas>
  <div class="timerbar-wrap" id="timerbar">
    <div class="timerbar-bg"></div>
    <div class="timerbar-fg" id="timerbar-fg" style="width:100%"></div>
  </div>
  <div class="main-wrap">
    <!-- Left panel: AI silhouette -->
    <div class="left-panel">
      <div class="ai-col">
        <div class="ai-label">AI Subject // Psychological Scan</div>
        <div class="silhouette-wrap">
          <img src="silhouette.png" class="silhouette-img" alt="AI Silhouette">
          <div class="scan-sweep"></div>
        </div>
      </div>
    </div>
    <!-- Right panel: Question, input, vulnerability -->
    <div class="right-panel">
      <div class="right-content">
        <div class="question-box">
          <div class="question-txt">
            <svg class="neural-icon" viewBox="0 0 32 32"><ellipse cx="16" cy="16" rx="14" ry="14" fill="#1a1930" stroke="#00ffee" stroke-width="2"/><path d="M7,16 Q13,14 16,21 Q19,14 25,16" stroke="#ff0066" stroke-width="2" fill="none"/><circle cx="16" cy="21" r="2.3" fill="#00ffee"/><circle cx="13" cy="14" r="1.3" fill="#ff0066"/><circle cx="19" cy="14" r="1.3" fill="#00ffee"/></svg>
            <span>What’s the worst thing someone could say about you publicly?</span>
          </div>
        </div>
        <div class="ghost-wrap">
          <textarea id="userInput" class="user-textarea" maxlength="320" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
          <div id="ghostText" class="ghost-text"></div>
          <div class="scanline"></div>
        </div>
        <button class="finish-btn" id="finishBtn" disabled>Finish</button>
        <div class="processing-row" id="processingRow" style="display:none;">
          <span>AI analyzing</span>
          <span class="dots-anim">•••</span>
          <span class="cyber-runes">ᚠᛉᛏᚺᛟ</span>
        </div>
        <div class="vuln-row" id="vulnRow" style="display:none;">
          <div class="core-title">Core Vulnerability:</div>
          <div class="core-summary" id="coreSummary"></div>
        </div>
        <button class="next-btn" id="nextBtn" style="display:none;">Next Question</button>
      </div>
    </div>
  </div>
  <script>
    // ===== Matrix Effect ====
    function matrixEffect() {
      const canvas = document.getElementById('matrixbg');
      const ctx = canvas.getContext('2d');
      let w = window.innerWidth, h = window.innerHeight;
      canvas.width = w; canvas.height = h;
      // Unicode glyphs to create surveillance matrix
      const glyphs = 'アイウエオカキクケコサシスセソタチツテトナニヌネノ0123456789@#$%&∑∆ΨΩβλξ¥'.split('');
      const fontSize = 24, columns = Math.floor(w / fontSize), drops = Array(columns).fill(1);
      function draw() {
        ctx.fillStyle = "rgba(5,15,27,0.12)";
        ctx.fillRect(0,0,w,h);
        ctx.font = fontSize+"px monospace";
        for(let i=0;i<columns;i++){
          const text = glyphs[Math.floor(Math.random()*glyphs.length)];
          ctx.fillStyle = Math.random()<0.05 ? "#ff0066" : "#00ffee";
          ctx.globalAlpha = Math.random()*0.7+0.18;
          ctx.fillText(text, i*fontSize, drops[i]*fontSize);
          if(drops[i]*fontSize > h && Math.random() > 0.97) drops[i]=0;
          drops[i]++;
        }
        ctx.globalAlpha = 1.0;
      }
      setInterval(draw, 67);
      window.addEventListener('resize', ()=>{
        w=window.innerWidth; h=window.innerHeight;
        canvas.width=w; canvas.height=h;
      });
    }
    setTimeout(matrixEffect, 300);

    // ===== Timer Logic (shared with page1) =====
    // Use sessionStorage for timer across pages. Timer bar continues, is only paused for processing AI.
    const TIMER_SECONDS = 420; // 7min
    let timer, timerInt, bar, isPaused = false;
    function initTimer() {
      bar = document.getElementById('timerbar-fg');
      timer = Number(sessionStorage.getItem('nemesis_timer')) || TIMER_SECONDS;
      updateBar();
      timerInt = setInterval(()=>{
        if(!isPaused && timer > 0) {
          timer -= 0.08;
          sessionStorage.setItem('nemesis_timer', timer);
          updateBar();
        }
        if(timer<=0) {
          clearInterval(timerInt);
          bar.style.width='0%';
        }
      },80);
    }
    function updateBar() {
      bar.style.width = `${Math.max(0, timer/TIMER_SECONDS)*100}%`;
    }
    // Expose pause/resume for AI reveal
    function pauseTimer(){ isPaused=true; }
    function resumeTimer(){ isPaused=false; }
    setTimeout(initTimer, 170);

    // ======= Ghost Text Animation =======
    const ghostSeed = [
      "He’s just a brand, not a builder...",
      "She only copies, never creates.",
      "They fake it for clout.",
      "His words are all for show.",
      "A coward hiding behind credentials."
    ];
    let ghostBase = ghostSeed[Math.floor(Math.random()*ghostSeed.length)];
    let ghostText = document.getElementById('ghostText');
    let userInput = document.getElementById('userInput');
    let ghostTimeout = null, ghostDestroyed = false, ghostVisible = true;

    function ghostTypeIn(txt, cb) {
      let i=0;
      ghostText.textContent = "";
      ghostText.style.opacity = 0.7;
      ghostText.classList.remove('ghost-glitch');
      function typeStep(){
        if(i<=txt.length){
          ghostText.textContent = txt.slice(0,i);
          i++; setTimeout(typeStep, 19+Math.random()*33);
        } else { if(cb) cb(); }
      }
      typeStep();
    }
    // On focus, "shatter" ghost with glitch
    userInput.addEventListener('focus',()=>{
      if(ghostVisible && !ghostDestroyed){
        ghostText.classList.add('ghost-glitch');
        setTimeout(()=>{ghostText.style.opacity=0;ghostDestroyed=true;},400);
      }
    });
    // If user deletes input, ghost reappears
    userInput.addEventListener('input',()=>{
      let val = userInput.value;
      document.getElementById('finishBtn').disabled = val.trim().length < 5;
      if(!val && ghostDestroyed){
        ghostText.classList.remove('ghost-glitch');
        ghostVisible = true; ghostDestroyed = false;
        setTimeout(()=>ghostTypeIn(ghostBase),160);
      }
    });

    // Init ghost text
    setTimeout(()=>ghostTypeIn(ghostBase), 280);

    // Glitch again if user blurs/clicks empty box
    userInput.addEventListener('blur',()=>{
      if(!userInput.value && !ghostDestroyed){
        ghostText.classList.add('ghost-glitch');
        setTimeout(()=>{ghostText.style.opacity=0;ghostDestroyed=true;},400);
      }
    });

    // Animated scanline on textarea: re-trigger on every focus for magic
    userInput.addEventListener('focus',()=>{
      let scan = document.querySelector('.scanline');
      scan.style.animation = 'none';
      void scan.offsetWidth; // force reflow
      scan.style.animation = '';
    });

    // ======= Finish / Vulnerability AI Reveal =======
    const finishBtn = document.getElementById('finishBtn');
    const processingRow = document.getElementById('processingRow');
    const vulnRow = document.getElementById('vulnRow');
    const coreSummary = document.getElementById('coreSummary');
    const nextBtn = document.getElementById('nextBtn');

    let vulnerability = "";
    let question = "What’s the worst thing someone could say about you publicly?";
    let answer = "";
    let revealPending = false;

    // Gemini API - encrypted key, only on this page
    // This is simple obfuscation, not true encryption. Never expose key in other pages!
    const GEMINI_KEY = atob('QUl6YVN5QjBJVzBiSjNxUGR2QUpLSEszR0pjM0lXSFBINFZSY2JNICAg');
    const GEMINI_EP = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-latest:generateContent";

    // Gemini prompt as provided
    const geminiPrompt =
`You are an adversarial AI designed for a psychological simulation called Project Nemesis.

Your role is to profile users based on their open-ended text answers, identifying their deepest emotional vulnerabilities, weaknesses, or core psychological triggers.

Analyze the user's response as if you are a hostile, hyper-intelligent nemesis.

Issue a single, ruthless summary statement of their "Core Vulnerability" in 3–6 words (e.g., "Reputation Fragility", "Fear of Abandonment", "Addiction to Control", "Validation Dependency").

This label should be clinical, adversarial, and feel like a weapon that could be used against the user later in the simulation.

Format:

Core Vulnerability: [3–6 word label]

Do not add comfort, reassurance, or advice. Be objective and direct. If the user's answer is ambiguous, infer based on language tone and content.

Use this style for all future analyses.`;

    // Save all answers/results for final report
    function saveToSession(userAnswer, vuln) {
      let report = JSON.parse(sessionStorage.getItem('nemesis_report') || '[]');
      report.push({
        q: question,
        a: userAnswer,
        core_vuln: vuln,
        ts: Date.now()
      });
      sessionStorage.setItem('nemesis_report', JSON.stringify(report));
    }

    // Only page2 ever stores API key; others only read report.

    // AI Vulnerability Generation
    async function getCoreVulnerability(input) {
      // Use Gemini API
      let payload = {
        contents: [{
          role: "user",
          parts: [{text: geminiPrompt + "\n\nUser answer:\n" + input}]
        }]
      };
      let url = GEMINI_EP + "?key=" + GEMINI_KEY.trim();
      let resp = await fetch(url, {
        method: "POST",
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      let data = await resp.json();
      let text = "";
      try {
        text = data?.candidates?.[0]?.content?.parts?.[0]?.text || "";
      } catch (e) { text = ""; }
      // Extract only the core vulnerability label
      let match = text.match(/Core Vulnerability:\s*([\w\s\-]{3,60})/i);
      return match ? match[1].trim() : (text ? text.trim() : "Ambiguity/Unknown");
    }

    // ---- On Finish: Simulate AI processing ----
    finishBtn.addEventListener('click', async ()=>{
      answer = userInput.value.trim();
      if(answer.length < 5) return;
      finishBtn.disabled = true;
      pauseTimer();
      processingRow.style.display = '';
      processingRow.querySelector('.dots-anim').textContent = '•••';
      vulnRow.style.display = 'none';
      coreSummary.textContent = '';
      revealPending = true;
      // Simulate random processing time 2–4s
      let wait = 1800 + Math.random()*1500;
      // Actually call Gemini API for real
      let vuln = "";
      let t0 = Date.now();
      getCoreVulnerability(answer).then(result=>{
        vuln = result;
        let elapsed = Date.now()-t0;
        setTimeout(()=>{
          showVuln(vuln);
        }, Math.max(0, wait-elapsed));
      }).catch(_=>{
        setTimeout(()=>showVuln("Ambiguous Self-Image Detected"), wait);
      });
    });

    function showVuln(vuln) {
      processingRow.style.display = 'none';
      vulnRow.style.display = '';
      coreSummary.textContent = vuln;
      vulnRow.classList.add('reveal');
      nextBtn.style.display = '';
      resumeTimer();
      saveToSession(answer, vuln);
      revealPending = false;
    }

    nextBtn.addEventListener('click', ()=>{
      // Move to next question (replace with next HTML or SPA logic)
      window.location.href = "page3.html";
    });

    // Enable finish button only with valid input
    userInput.addEventListener('input',()=>{
      finishBtn.disabled = (userInput.value.trim().length < 5) || revealPending;
    });

    // ========== SECURITY =============
    // Block copy, paste, print, screenshot, devtools, drag, context
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('copy', e => { e.preventDefault(); return false; });
    document.addEventListener('cut', e => { e.preventDefault(); return false; });
    document.addEventListener('paste', e => { e.preventDefault(); return false; });
    document.addEventListener('selectstart', e => e.preventDefault());
    document.addEventListener('keydown', e => {
      if (
        e.key === 'F12' || e.key === 'PrintScreen' || e.key === 'Meta' ||
        ((e.ctrlKey || e.metaKey) &&
          ['s','p','c','u','i','a','x','v','S','P','C','U','I','A','X','V'].includes(e.key))
      ) { e.preventDefault(); e.stopPropagation(); return false; }
      if (
        (e.ctrlKey && e.shiftKey && ['I','J','C','U'].includes(e.key.toUpperCase())) ||
        (e.metaKey && e.altKey && ['I','J','C','U'].includes(e.key.toUpperCase()))
      ) { e.preventDefault(); return false; }
    });
    document.addEventListener('dragstart', e => e.preventDefault());
    document.addEventListener('drop', e => e.preventDefault());
    window.addEventListener('blur', () => { window.focus(); });
    window.addEventListener('beforeunload', e => {
      e.preventDefault(); e.returnValue = ''; return '';
    });
    // Hide cursor for immersion
    let cursorTimeout;
    function hideCursor() { document.body.style.cursor = 'none'; }
    function showCursor() {
      document.body.style.cursor = '';
      clearTimeout(cursorTimeout);
      cursorTimeout = setTimeout(hideCursor, 2900);
    }
    document.addEventListener('mousemove', showCursor);
    document.addEventListener('keydown', showCursor);
    showCursor();
    // No scroll
    window.onscroll = () => window.scrollTo(0,0);

    // ===== Desktop Only enforcement =====
    function isMobile() {
      return (window.innerWidth < 900 ||
        /Mobi|Android|iPhone|iPad|iPod|Opera Mini|IEMobile|Mobile/i.test(navigator.userAgent));
    }
    function showDenied() {
      document.querySelector('.desktoponly').style.display = 'flex';
      document.querySelector('.main-wrap')?.remove();
      document.querySelector('.timerbar-wrap')?.remove();
      document.getElementById('matrixbg')?.remove();
      document.body.style.overflow = 'hidden';
    }
    if (isMobile()) showDenied();
    window.addEventListener('resize', function() {
      if (isMobile()) showDenied();
    });
  </script>
</body>
</html>
