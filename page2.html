<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Project Nemesis: Psychological Fingerprinting</title>
  <meta name="viewport" content="width=1024, user-scalable=no">
  <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono:700|Oswald:700&display=swap" rel="stylesheet">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #070911 0%, #0d1220 70%, #101826 100%);
      overflow: hidden;
      color: #fff;
      font-family: 'IBM Plex Mono', 'Oswald', 'Consolas', monospace;
      user-select: none;
      scrollbar-width: none;
      -ms-overflow-style: none;
      letter-spacing: 0.015em;
    }
    body::-webkit-scrollbar { display: none; }

    #denied {
      position: fixed; inset: 0;
      z-index: 9999;
      background: #060713e8;
      display: flex;
      flex-direction: column;
      align-items: center; justify-content: center;
      font-family: Oswald, sans-serif;
      font-size: 2.2rem;
      color: #00ffee;
      letter-spacing: 0.11em;
      text-align: center;
      backdrop-filter: blur(2px);
      animation: deniedFade 1.2s infinite alternate;
    }
    @keyframes deniedFade {
      0% { opacity: 1; }
      100% { opacity: 0.8; }
    }
    .container {
      width: 100vw; height: 100vh;
      display: flex; flex-direction: row;
      min-width: 900px;
      position: relative;
      z-index: 1;
      overflow: hidden;
    }
    .panel {
      height: 100vh;
      flex: 1 1 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
      overflow: hidden;
    }
    .left-panel {
      background: linear-gradient(120deg, #070a15 75%, #10171f 100%);
      box-shadow: 2px 0 22px #0be4ff09 inset;
      position: relative;
    }
    .scan-matrix {
      position: absolute;
      left: 0; top: 0;
      width: 100%; height: 100%;
      opacity: 0.14;
      z-index: 2;
      pointer-events: none;
      animation: matrixScroll 15s linear infinite;
      background: url('https://assets.codepen.io/1462889/matrix-bg-vert.svg');
      background-size: cover;
      background-repeat: repeat;
      filter: blur(0.6px) grayscale(0.3);
      mix-blend-mode: lighten;
    }
    @keyframes matrixScroll {
      0% { background-position-y: 0px; }
      100% { background-position-y: 1000px; }
    }
    .silhouette-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 5;
      width: 90%;
    }
    .scan-label {
      margin-bottom: 1.6rem;
      font-size: 1.08rem;
      letter-spacing: 0.14em;
      color: #81e6ff;
      font-family: 'IBM Plex Mono', monospace;
      text-transform: uppercase;
      opacity: 0.82;
      filter: drop-shadow(0 0 6px #1ef7ff77);
      text-align: center;
      font-weight: 700;
      letter-spacing: 0.18em;
    }
    .silhouette-img {
      width: 250px;
      max-width: 95vw;
      border-radius: 44% 48% 59% 41%/46% 40% 60% 54%;
      filter: blur(1.2px) brightness(1.13) drop-shadow(0 0 36px #00ffee88) drop-shadow(0 0 12px #001b21) grayscale(0.1);
      box-shadow: 0 0 50px #00ffee55, 0 0 120px #07091c;
      animation: flickerGlow 2.8s infinite alternate, breatheShadow 6s infinite;
      transition: filter 0.3s;
      margin-bottom: 1.1rem;
    }
    @keyframes flickerGlow {
      0%,100% { filter: blur(1.1px) brightness(1.09) drop-shadow(0 0 36px #00ffee66); }
      35% { filter: blur(0.8px) brightness(1.25) drop-shadow(0 0 60px #00ffeecc); }
      52% { filter: blur(1.8px) brightness(1.19) drop-shadow(0 0 54px #00ffee66);}
      90% { filter: blur(0.6px) brightness(1.19) drop-shadow(0 0 39px #00ffeecc);}
    }
    @keyframes breatheShadow {
      0%,100% { box-shadow: 0 0 50px #00ffee33, 0 0 120px #07091c; }
      40% { box-shadow: 0 0 90px #00ffee99, 0 0 180px #101826; }
      70% { box-shadow: 0 0 36px #ff006655, 0 0 150px #101826; }
    }
    .scanline-anim {
      position: absolute;
      left: 8%; top: 0;
      width: 84%; height: 12px;
      background: linear-gradient(180deg,#00ffee44,#fff3 90%,#0ff2 100%);
      opacity: 0.26;
      border-radius: 80%;
      filter: blur(2.2px);
      z-index: 10;
      animation: scanSweep 3.2s infinite;
      pointer-events: none;
    }
    @keyframes scanSweep {
      0% { top: 5px; opacity: 0.1; }
      18% { opacity: 0.46; }
      45% { opacity: 0.21; }
      70% { opacity: 0.39; }
      100% { top: 205px; opacity: 0.05; }
    }
    .question-section {
      margin-top: 1.7rem;
      width: 94%;
      max-width: 390px;
      background: rgba(10,17,27,0.91);
      border-radius: 14px;
      box-shadow: 0 4px 32px #23ffee13;
      padding: 1.1rem 1.7rem 1.3rem 1.5rem;
      border: 1.2px solid #0af1ff33;
      position: relative;
      z-index: 20;
    }
    .question-row {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 1.21rem;
      color: #80e2ff;
      font-weight: 700;
      letter-spacing: 0.04em;
      margin-bottom: 0.95em;
      display: flex;
      align-items: center;
      gap: 0.9em;
      text-shadow: 0 0 9px #00ffee44;
      border-left: 4px solid #00ffee88;
      padding-left: 0.75em;
    }
    .neural-icon {
      width: 27px; height: 27px;
      filter: drop-shadow(0 0 8px #00ffee77);
      flex-shrink: 0;
      margin-bottom: -2px;
    }
    .answer-input-wrap {
      position: relative;
      margin-top: 0.45em;
      margin-bottom: 1.5em;
    }
    .ghost-input {
      position: absolute;
      top: 11px; left: 19px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 1.08rem;
      color: #71e5e8cc;
      pointer-events: none;
      opacity: 0.65;
      letter-spacing: 0.01em;
      user-select: none;
      z-index: 4;
      transition: opacity 0.15s;
      white-space: pre-line;
      animation: ghostType 1.2s steps(9) 1;
      text-shadow: 0 0 8px #00ffee88, 0 0 2px #0009;
    }
    @keyframes ghostType {
      from { opacity: 0; }
      to { opacity: 0.65; }
    }
    .ghost-shatter {
      animation: glitchShatter 0.39s cubic-bezier(.6,0,.58,1.24) 1;
      opacity: 0 !important;
    }
    @keyframes glitchShatter {
      0% { filter: blur(0px) brightness(1); opacity: 0.65;}
      55% { filter: blur(3.5px) brightness(1.7); opacity: 0.85;}
      100% { filter: blur(9px) brightness(2); opacity: 0; }
    }
    .answer-textarea {
      width: 98%; min-width: 160px;
      min-height: 68px; max-height: 144px;
      padding: 14px 18px 18px 19px;
      resize: vertical;
      background: linear-gradient(120deg,#0d1e2c 80%,#101828 100%);
      color: #fff;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 1.13rem;
      border-radius: 9px;
      border: 2.2px solid #19f2f8bb;
      outline: none;
      box-shadow: 0 0 8px #00ffee33;
      caret-color: #00ffee;
      transition: border 0.25s, box-shadow 0.22s;
      animation: textareaPulse 2.8s infinite alternate;
    }
    .answer-textarea:focus {
      border: 2.4px solid #ff0066dd;
      box-shadow: 0 0 20px #ff006644, 0 0 4px #fff4;
    }
    @keyframes textareaPulse {
      0% { box-shadow: 0 0 8px #00ffee22; border-color: #19f2f888;}
      60% { box-shadow: 0 0 16px #00ffee66; border-color: #00ffee99;}
      90% { box-shadow: 0 0 8px #00ffee22; border-color: #19f2f888;}
    }
    .finish-btn {
      width: 100%;
      padding: 0.77em 1.1em;
      background: linear-gradient(90deg,#101826,#1a1d27 60%,#00ffee33 100%);
      color: #fff;
      font-size: 1.09rem;
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 700;
      letter-spacing: 0.08em;
      border: 2.2px solid #00ffee88;
      border-radius: 7px;
      box-shadow: 0 0 14px #00ffee33;
      outline: none;
      cursor: pointer;
      margin-top: 1em;
      transition: background 0.22s, color 0.19s, border 0.19s;
      position: relative;
      z-index: 10;
      opacity: 0.97;
    }
    .finish-btn:disabled {
      opacity: 0.56;
      filter: grayscale(0.7);
      cursor: not-allowed;
    }
    .processing-row {
      display: flex;
      align-items: center;
      gap: 1.5em;
      justify-content: center;
      font-size: 1.18rem;
      color: #fff;
      margin-top: 2.2em;
      font-family: 'IBM Plex Mono', monospace;
      letter-spacing: 0.06em;
      animation: scanGlow 1.8s infinite alternate;
      opacity: 0.93;
    }
    @keyframes scanGlow {
      0% { color: #fff; text-shadow: 0 0 3px #00ffee55;}
      80% { color: #00ffee; text-shadow: 0 0 18px #00ffeeee;}
      100% { color: #fff;}
    }
    .rune-dots {
      font-size: 2rem;
      letter-spacing: 0.25em;
      color: #00ffee;
      filter: blur(0.8px);
      animation: dotsAnim 1.2s steps(6) infinite;
    }
    @keyframes dotsAnim {
      0% { opacity: 0.2; }
      25% { opacity: 0.6; }
      60% { opacity: 1; }
      100% { opacity: 0.2; }
    }
    .core-vuln-reveal {
      margin-top: 2.6em;
      padding: 1.4em 1.2em;
      border-radius: 12px;
      background: linear-gradient(120deg,#12182a 70%,#101820 100%);
      border: 2.2px solid #00ffee55;
      box-shadow: 0 0 20px #00ffee44;
      color: #fff;
      font-size: 1.17rem;
      letter-spacing: 0.08em;
      text-align: center;
      font-family: 'IBM Plex Mono', monospace;
      opacity: 0;
      transform: scale(0.95) translateY(18px);
      filter: blur(10px);
      animation: vulnRevealAnim 1.1s cubic-bezier(.25,2.7,.28,0.97) forwards;
    }
    @keyframes vulnRevealAnim {
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
        filter: blur(0px);
      }
    }
    .next-btn {
      width: 100%;
      margin-top: 2.2em;
      padding: 0.85em 1em;
      background: linear-gradient(90deg,#191d26 0,#101a23 50%,#ff006633 100%);
      color: #fff;
      font-size: 1.11rem;
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 700;
      letter-spacing: 0.08em;
      border: 2.2px solid #ff006677;
      border-radius: 7px;
      box-shadow: 0 0 14px #ff006633;
      outline: none;
      cursor: pointer;
      position: relative;
      opacity: 0.93;
      transition: background 0.2s, border 0.2s;
    }
    .right-panel {
      background: linear-gradient(130deg, #0d1e2c 60%, #101826 100%);
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      overflow: hidden;
      min-width: 320px;
      padding-top: 70px;
    }
    .right-content-wrap {
      width: 97%;
      max-width: 400px;
      margin: 0 auto;
      padding: 0 0.9em;
      position: relative;
      z-index: 5;
      background: rgba(7,13,24,0.74);
      border-radius: 13px;
      box-shadow: 0 4px 22px #3e9ea833;
      min-height: 260px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .vuln-label {
      font-size: 1.07rem;
      color: #6fe3f7;
      letter-spacing: 0.07em;
      text-align: center;
      margin-bottom: 1.2em;
      margin-top: 0.6em;
      font-family: 'IBM Plex Mono', monospace;
      font-weight: bold;
      opacity: 0.83;
    }
    .timerbar-wrap {
      position: absolute;
      top: 0; left: 0;
      width: 100vw; height: 7px;
      background: transparent;
      z-index: 999;
      pointer-events: none;
      overflow: hidden;
    }
    .timerbar-bg {
      position: absolute;
      top: 0; left: 0;
      width: 100vw; height: 100%;
      background: linear-gradient(90deg,#00ffdd44 0%, #099 50%, #e0195e88 100%);
      opacity: 0.16; filter: blur(4px);
      border-bottom: 1px solid #199a;
    }
    .timerbar-fg {
      height: 100%;
      background: linear-gradient(90deg,#24f6,#3ff 10%,#f13f62 80%,#1ad9c3);
      box-shadow: 0 0 12px #28ffe8,0 0 22px #ee275a66;
      border-radius: 4px;
      animation: barwave 2.2s infinite alternate;
      transition: width 0.24s cubic-bezier(.46,1.32,.54,.97);
    }
    @media (max-width: 900px) {
      .container, .timerbar-wrap { display: none !important; }
      #denied { display: flex !important; }
    }
    @media (max-width: 1200px) {
      .question-section { padding: 1.1rem 0.6rem 1.1rem 0.7rem; }
      .right-content-wrap { padding: 0 0.35em; }
    }
  </style>
</head>
<body>
  <div id="denied" style="display:none;">
    <span style="font-size:2.4rem; color:#ff0066;">Access Denied</span><br>
    <span style="font-size:1.17rem;color:#8de3ff;letter-spacing:0.09em;">Desktop/Tablet Only</span>
    <div class="matrix-anim" style="margin-top:2em;opacity:0.16;font-size:2.7rem;">1010101100111010<br>000110110011</div>
  </div>
  <div class="timerbar-wrap" id="timerbar">
    <div class="timerbar-bg"></div>
    <div class="timerbar-fg" id="timerbar-fg"></div>
  </div>
  <div class="container">
    <div class="panel left-panel">
      <div class="scan-matrix"></div>
      <div class="silhouette-wrap">
        <div class="scan-label">AI Subject // Psychological Scan</div>
        <img src="silhouette.png" alt="AI Silhouette" class="silhouette-img" draggable="false">
        <div class="scanline-anim"></div>
        <section class="question-section">
          <div class="question-row">
            <svg class="neural-icon" viewBox="0 0 26 26"><ellipse cx="13" cy="13" rx="12" ry="12" fill="none" stroke="#00ffee" stroke-width="2.5"/><ellipse cx="13" cy="13" rx="6.7" ry="6.7" fill="none" stroke="#ff0066" stroke-width="2.3"/><circle cx="13" cy="13" r="3.2" fill="#fff" stroke="#00ffee" stroke-width="1.2"/></svg>
            <span>What’s the worst thing someone could say about you publicly?</span>
          </div>
          <div class="answer-input-wrap">
            <span class="ghost-input" id="ghostinput">He’s just a brand, not a builder...</span>
            <textarea class="answer-textarea" id="answer" autocomplete="off" spellcheck="false" maxlength="280"></textarea>
          </div>
          <button class="finish-btn" id="finishbtn" disabled>Finish</button>
        </section>
      </div>
    </div>
    <div class="panel right-panel">
      <div class="right-content-wrap" id="right-content">
        <div class="vuln-label">Core Vulnerability: <span style="color:#ff0066;">[hidden]</span></div>
        <div id="ai-processing" style="display:none;" class="processing-row">
          <span>AI Profiling</span>
          <span class="rune-dots" id="dots">⟡⟡⟡</span>
        </div>
        <div id="corevuln" style="display:none;"></div>
        <button class="next-btn" id="nextbtn" style="display:none;">Next Question</button>
      </div>
    </div>
  </div>
  <script>
    // ========== GLOBALS / CONFIG ==========
    // --- Gemini API encrypted and in-page only ---
    const _enc_key = atob('QUl6YVN5QjBJVzBiSjNxUGR2QUpLSEtHM0dKM0lXSFBINFZSZGI=');
    const _gemini_endpoint = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';
    const _api_prompt = `
You are an adversarial AI designed for a psychological simulation called Project Nemesis.

Your role is to profile users based on their open-ended text answers, identifying their deepest emotional vulnerabilities, weaknesses, or core psychological triggers.

Analyze the user's response as if you are a hostile, hyper-intelligent nemesis.

Issue a single, ruthless summary statement of their "Core Vulnerability" in 3–6 words (e.g., "Reputation Fragility", "Fear of Abandonment", "Addiction to Control", "Validation Dependency").

This label should be clinical, adversarial, and feel like a weapon that could be used against the user later in the simulation.

Format:

Core Vulnerability: [3–6 word label]

Do not add comfort, reassurance, or advice. Be objective and direct. If the user's answer is ambiguous, infer based on language tone and content.

Use this style for all future analyses.
`;

    // ======== ACCESS CONTROL ========
    function isMobile() {
      return (window.innerWidth < 900 ||
        /Mobi|Android|iPhone|iPad|iPod|Opera Mini|IEMobile|Mobile/i.test(navigator.userAgent));
    }
    function showDenied() {
      document.getElementById('denied').style.display = 'flex';
      document.querySelector('.container')?.remove();
      document.querySelector('.timerbar-wrap')?.remove();
      document.body.style.overflow = 'hidden';
    }
    if (isMobile()) showDenied();
    window.addEventListener('resize', () => { if (isMobile()) showDenied(); });

    // ======== TIMER (continued from page1) ========
    let totalTime = sessionStorage.getItem('nemesis_timer') ? parseFloat(sessionStorage.getItem('nemesis_timer')) : 420;
    let timerBar = document.getElementById('timerbar-fg');
    let timerActive = true;
    function updateTimerBar() {
      let perc = Math.max(0, totalTime / 420);
      timerBar.style.width = `${perc * 100}%`;
    }
    function timerLoop() {
      if (!timerActive) return;
      totalTime -= 0.05;
      sessionStorage.setItem('nemesis_timer', totalTime);
      updateTimerBar();
      if (totalTime <= 0) {
        timerBar.style.opacity = '0';
        // Optionally, end simulation if timer expires
        setTimeout(() => { window.location.href = 'page_expired.html'; }, 550);
        return;
      }
      setTimeout(timerLoop, 50);
    }
    setTimeout(timerLoop, 50);

    // ======== GHOST INPUT LOGIC =========
    const ghostText = `He’s just a brand, not a builder...`;
    const ghostInput = document.getElementById('ghostinput');
    const textarea = document.getElementById('answer');
    const finishbtn = document.getElementById('finishbtn');
    let userInteracted = false, ghostShattered = false, ghostTimer;
    let lastVal = "";
    function ghostTypeIn() {
      ghostInput.textContent = '';
      let chars = ghostText.split('');
      let i = 0;
      function typeChar() {
        if (i < chars.length) {
          ghostInput.textContent += chars[i];
          i++;
          setTimeout(typeChar, 27 + Math.random() * 25);
        }
      }
      typeChar();
    }
    textarea.addEventListener('focus', () => {
      if (!ghostShattered) {
        ghostInput.classList.add('ghost-shatter');
        ghostShattered = true;
        setTimeout(() => { ghostInput.style.opacity = 0; }, 350);
      }
    });
    textarea.addEventListener('input', () => {
      finishbtn.disabled = (textarea.value.trim().length < 3);
      if (textarea.value.length === 0 && userInteracted) {
        // Animate ghost retype
        ghostInput.classList.remove('ghost-shatter');
        ghostInput.style.opacity = 0.65;
        ghostShattered = false;
        ghostTypeIn();
      }
      if (textarea.value.length > 0) {
        userInteracted = true;
        ghostInput.style.opacity = 0;
      }
      lastVal = textarea.value;
    });
    // In case the user just deletes all input
    textarea.addEventListener('blur', () => {
      if (textarea.value.length === 0 && userInteracted) {
        setTimeout(() => {
          ghostInput.classList.remove('ghost-shatter');
          ghostInput.style.opacity = 0.65;
          ghostShattered = false;
          ghostTypeIn();
        }, 160);
      }
    });

    // ======== SECURITY RESTRICTIONS ========
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('copy', e => { e.preventDefault(); return false; });
    document.addEventListener('cut', e => { e.preventDefault(); return false; });
    document.addEventListener('paste', e => { e.preventDefault(); return false; });
    document.addEventListener('selectstart', e => e.preventDefault());
    document.addEventListener('keydown', e => {
      if (
        e.key === 'F12' || e.key === 'PrintScreen' || e.key === 'Meta' ||
        ((e.ctrlKey || e.metaKey) &&
          ['s','p','c','u','i','a','x','v','S','P','C','U','I','A','X','V'].includes(e.key))
      ) {
        e.preventDefault(); e.stopPropagation(); return false;
      }
      if (
        (e.ctrlKey && e.shiftKey && ['I','J','C','U'].includes(e.key.toUpperCase())) ||
        (e.metaKey && e.altKey && ['I','J','C','U'].includes(e.key.toUpperCase()))
      ) {
        e.preventDefault(); return false;
      }
    });
    document.addEventListener('dragstart', e => e.preventDefault());
    document.addEventListener('drop', e => e.preventDefault());
    window.addEventListener('blur', () => { window.focus(); });
    window.addEventListener('beforeunload', e => {
      e.preventDefault();
      e.returnValue = '';
      return '';
    });
    window.onscroll = () => window.scrollTo(0,0);

    // ======== AI PROCESSING & GEMINI CALL =========
    const aiProcessing = document.getElementById('ai-processing');
    const corevuln = document.getElementById('corevuln');
    const vulnLabel = document.querySelector('.vuln-label');
    const nextbtn = document.getElementById('nextbtn');
    finishbtn.addEventListener('click', async () => {
      let userInput = textarea.value.trim();
      if (userInput.length < 3) return;
      finishbtn.disabled = true;
      timerActive = false;
      aiProcessing.style.display = 'flex';
      corevuln.style.display = 'none';
      vulnLabel.innerHTML = `Core Vulnerability: <span style="color:#6de6fc;">[scanning...]</span>`;
      // Animate runes/dots
      let dots = document.getElementById('dots');
      let dotStrs = ['⟡⟡⟡','⟡⟡','⟡⟡⟡⟡','⟡⟡⟡','⟡⟡⟡⟡⟡','⟡⟡'];
      let i = 0;
      let dotsAnim = setInterval(() => { dots.textContent = dotStrs[i%dotStrs.length]; i++; }, 270);

      // Simulate random wait (2-4s) for effect
      let simWait = 1800 + Math.random() * 2000;
      let vuln = '';
      try {
        vuln = await geminiCoreVulnerability(userInput);
      } catch (e) {
        vuln = 'Unknown Self-Worth Crisis';
      }
      setTimeout(() => {
        aiProcessing.style.display = 'none';
        clearInterval(dotsAnim);
        corevuln.style.display = 'block';
        corevuln.className = 'core-vuln-reveal';
        vulnLabel.innerHTML = `<span style="color:#80e2ff;">Core Vulnerability:</span>`;
        corevuln.textContent = vuln || 'Unknown Vulnerability';
        nextbtn.style.display = 'block';
        timerActive = true;
      }, simWait);
    });

    nextbtn.addEventListener('click', () => {
      // Save the user's answer and vulnerability in sessionStorage
      let nemesisData = JSON.parse(sessionStorage.getItem('nemesis_report') || '{}');
      nemesisData['q1'] = {
        question: "What’s the worst thing someone could say about you publicly?",
        answer: textarea.value.trim(),
        ghost: ghostText,
        vulnerability: corevuln.textContent
      };
      sessionStorage.setItem('nemesis_report', JSON.stringify(nemesisData));
      // Timer continues
      window.location.href = 'page3.html'; // Next question/page
    });

    // ========== GEMINI AI API CALL ==========
    async function geminiCoreVulnerability(userInput) {
      // Key is obfuscated/encoded, endpoint correct
      const key = _enc_key;
      const prompt = _api_prompt + '\nUser Answer: ' + userInput.trim();
      // Compose Gemini API request
      const res = await fetch(_gemini_endpoint + '?key=' + key, {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ role: "user", parts: [{ text: prompt }] }],
          generationConfig: { temperature: 0.31, maxOutputTokens: 56 }
        })
      });
      let data = await res.json();
      // Gemini API returns response in candidates[0].content.parts[0].text
      let output = (data?.candidates?.[0]?.content?.parts?.[0]?.text || '').trim();
      let match = output.match(/Core Vulnerability: (.+)/i);
      return match ? match[1].trim() : (output ? output : 'Unknown Vulnerability');
    }

    // ======= SESSION INIT (FIRST LOAD) =======
    window.onload = () => {
      updateTimerBar();
      ghostTypeIn();
      // Set up session report for page2 if not yet
      if (!sessionStorage.getItem('nemesis_report')) {
        sessionStorage.setItem('nemesis_report', JSON.stringify({}));
      }
      // Persist timer if refreshed
      if (!sessionStorage.getItem('nemesis_timer')) {
        sessionStorage.setItem('nemesis_timer', '420');
      }
    };
  </script>
</body>
</html>
