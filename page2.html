<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nemesis Simulation — Psychological Fingerprinting</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #17191d;
      --card: rgba(19,23,30,0.97);
      --glow: #00f6ff;
      --shadow: #00f6ff24;
      --text: #d6f7fa;
      --bubble: #ebf7fb;
      --bubble-txt: #163e48;
      --mono: 'JetBrains Mono', monospace;
      --timerbar: #00e0ff;
      --timerbg: #10161b;
      --accent: #00e0ff;
      --err: #2ecbfa;
    }
    html, body {margin:0;padding:0;min-height:100vh;min-width:100vw;background:var(--bg);color:var(--text);font-family:var(--mono);}
    body {overflow-x:hidden;}
    .timer-bar {
      position:fixed;top:0;left:0;width:100vw;height:36px;background:var(--timerbg);z-index:100;display:flex;align-items:center;font-family:var(--mono);font-size:1.2rem;color:var(--timerbar);border-bottom:2px solid var(--timerbar);box-shadow:0 2px 22px #00161a88;
    }
    .timer-bar-progress {
      position:absolute;left:0;top:0;height:4px;width:100vw;background:var(--timerbar);box-shadow:0 0 14px var(--timerbar);z-index:101;transition:width 0.5s;
    }
    .timer-bar-inner {margin-left:20px;display:flex;align-items:center;gap:13px;font-family:var(--mono);}
    .main {
      width:100vw;min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:3;position:relative;padding-top:62px;
    }
    .nemesis-row {
      display:flex;flex-direction:row;width:100vw;max-width:1680px;justify-content:center;align-items:flex-start;gap:64px;margin:0 auto;min-height:700px;
    }
    .crowd-zone {
      flex:1 1 45%;display:flex;flex-direction:column;justify-content:center;align-items:center;min-width:380px;max-width:700px;margin-top:14px;
    }
    .question-zone {
      flex:1 1 55%;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;min-width:440px;max-width:960px;padding-top:14px;
    }
    .question {
      font-size:2.1rem;font-family:var(--mono);font-weight:700;letter-spacing:0.04em;margin-bottom:40px;color:var(--text);width:100%;text-align:center;position:relative;
    }
    .blinking-cursor {display:inline-block;width:18px;height:2.1rem;background:transparent;border-left:3px solid var(--accent);margin-left:8px;animation:blink 0.85s steps(1) infinite;}
    @keyframes blink {0%,100%{opacity:1;}50%{opacity:0;}}
    .bubble-silhouette-area {
      width:370px;height:320px;position:relative;display:block;margin:0 auto;margin-bottom:20px;
    }
    .silhouette {
      position:absolute;left:50%;top:46%;transform:translate(-50%,-50%);z-index:2;max-width:150px;min-width:90px;width:120px;height:230px;display:block;filter:drop-shadow(0 8px 44px #00ffe88c) grayscale(0.08) brightness(0.92);opacity:0.98;user-select:none;pointer-events:none;
    }
    .bubbles {
      position:absolute;left:0;top:0;width:100%;height:100%;z-index:3;pointer-events:none;
    }
    .bubble {
      position:absolute;background:var(--bubble);color:var(--bubble-txt);padding:12px 24px;font-size:1.18rem;font-family:var(--mono);border-radius:28px;box-shadow:0 2px 16px var(--shadow);font-weight:700;opacity:0;transform:scale(0.94);animation:fadeBubble 0.9s forwards;transition:filter 0.2s,box-shadow 0.23s;border:2px solid #bbf8ff;user-select:none;letter-spacing:0.04em;
    }
    @keyframes fadeBubble {0%{opacity:0;transform:scale(0.82);}70%{opacity:1;}100%{opacity:1;transform:scale(1);}}
    .input-area {width:96%;margin:0 auto;position:relative;margin-top:30px;}
    .response-box {
      width:100%;min-height:145px;max-height:280px;background:#151f25f9;border-radius:16px;border:2.5px solid var(--glow);color:var(--text);font-size:1.35rem;font-family:var(--mono);padding:28px 19px 24px 24px;box-sizing:border-box;resize:vertical;outline:none;margin-bottom:0;margin-top:0;box-shadow:0 2px 32px 0 #00e0ff17;z-index:7;
    }
    .response-box:focus {border:2.5px solid var(--accent);box-shadow:0 0 17px #00e0ff77;}
    .sim-placeholder {position:absolute;left:27px;top:30px;right:17px;font-family:var(--mono);color:#5ae7ff;opacity:0.47;font-size:1.17rem;pointer-events:none;z-index:9;white-space:pre-line;user-select:none;animation:fadeInSimInput 1.1s;}
    @keyframes fadeInSimInput {0%{opacity:0;}100%{opacity:0.47;}}
    .advance-btn {display:none;margin:32px 0 0 0;padding:17px 60px;font-size:1.23rem;font-family:var(--mono);font-weight:700;color:#fff;background:linear-gradient(90deg,var(--accent) 45%,#08c8db 120%);border:none;border-radius:10px;box-shadow:0 2px 30px #00e0ff26;cursor:pointer;letter-spacing:0.17em;text-shadow:0 2px 16px #10113b,0 1px 0 #0cfff126;transition:opacity 0.22s,box-shadow 0.16s,filter 0.12s;z-index:100;}
    .advance-btn:active {filter:brightness(0.86);}
    .input-warning {color:var(--err);font-size:1.05rem;margin-top:7px;min-height:18px;display:block;text-align:left;font-family:var(--mono);}
    .loader-bar {width:99%;margin:38px auto 0 auto;display:flex;align-items:center;justify-content:center;height:44px;flex-direction:column;}
    .loader-spinner {border:5px solid #21ecec36;border-top:5px solid var(--accent);border-radius:50%;width:46px;height:46px;animation:spin 0.9s linear infinite;margin-bottom:10px;}
    @keyframes spin {100%{transform:rotate(360deg);}}
    .system-label {font-size:1.13rem;color:var(--accent);font-family:var(--mono);opacity:0.73;margin-bottom:8px;text-align:center;letter-spacing:0.13em;}
    .annotation-bottom {margin:52px 0 0 0;font-family:var(--mono);color:var(--accent);font-size:1.22rem;background:#10282fe6;border-radius:14px 19px 19px 14px;padding:20px 42px;box-shadow:0 0 44px #00f5ff33;border-left:6px solid var(--accent);letter-spacing:0.10em;opacity:0.97;z-index:40;animation:fadeInAnno 0.8s cubic-bezier(.37,2.1,.53,.87);text-align:center;margin-bottom:31px;}
    @keyframes fadeInAnno {0%{opacity:0;filter:blur(10px) brightness(1.7);}70%{opacity:0.97;filter:blur(0.7px) brightness(1.2);}100%{opacity:0.97;filter:none;}}
    @media (max-width:1000px) {.main{padding-top:56px;}.nemesis-row{flex-direction:column;gap:0;}.crowd-zone,.question-zone{min-width:0;max-width:99vw;margin:0;padding:0;}}
    @media (max-width:700px) {
      .question{font-size:1.07rem;}.annotation-bottom{font-size:1.03rem;}
      .response-box,.sim-placeholder{font-size:1.04rem;}
      .silhouette{max-width:70px;height:96px;}
      .bubble-silhouette-area{width:200px;height:190px;}
    }
    @media (max-width:500px) {.input-area{width:99vw;}.bubble-silhouette-area{width:150px;height:160px;}}
    @media print {body,html{display:none!important;}}
  </style>
</head>
<body>
  <div class="timer-bar">
    <div class="timer-bar-progress" id="timer-bar-progress"></div>
    <div class="timer-bar-inner">
      <span style="font-size:1.1em;vertical-align:middle;line-height:0;">⏳</span>
      <span id="timer-text">7:00</span>
      <span style="font-size:1.08em;color:var(--accent);margin-left:18px;">Total time remaining</span>
    </div>
  </div>
  <div class="main">
    <div class="nemesis-row">
      <!-- LEFT: Bubbles + Silhouette -->
      <div class="crowd-zone">
        <div class="bubble-silhouette-area" id="bubble-area">
          <img class="silhouette" src="silhouette.png" alt="Person silhouette"/>
          <div class="bubbles" id="bubbles"></div>
        </div>
      </div>
      <!-- RIGHT: Question + input + system feedback -->
      <div class="question-zone">
        <div class="question" id="question">
          Question 1: What’s the worst thing someone could say about you publicly?
          <span class="blinking-cursor"></span>
        </div>
        <div class="input-area" style="width:100%;">
          <div class="sim-placeholder" id="sim-placeholder"></div>
          <textarea class="response-box" id="response-box" placeholder="" autocomplete="off"></textarea>
          <span class="input-warning" id="input-warning"></span>
          <button class="advance-btn" id="advance-btn">Advance</button>
          <div id="loader-area"></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // 7 minute timer
    let totalSeconds = 7 * 60;
    let timerDisplay = document.getElementById('timer-text');
    let timerBar = document.getElementById('timer-bar-progress');
    function formatTime(secs) {
      let m = Math.floor(secs / 60).toString();
      let s = (secs % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }
    function updateTimer() {
      timerDisplay.textContent = formatTime(totalSeconds);
      timerBar.style.width = (totalSeconds/(7*60)*100) + "%";
      totalSeconds--;
      if (totalSeconds >= 0) setTimeout(updateTimer, 1000);
      else { timerDisplay.textContent = "0:00"; timerBar.style.width = "0%"; }
    }
    updateTimer();

    // Simulated input as placeholder in textarea
    const simExamples = `"He’s just a brand, not a builder."
"Everything he made was hype — no substance."`;
    let simPlaceholder = document.getElementById('sim-placeholder');
    let respBox = document.getElementById('response-box');
    let advanceBtn = document.getElementById('advance-btn');
    let warningEl = document.getElementById('input-warning');
    let showingSim = true, spidx = 0, charDelay = 13;
    function typeSimPlaceholder() {
      if (spidx < simExamples.length) {
        simPlaceholder.textContent = simExamples.slice(0, spidx);
        spidx++;
        setTimeout(typeSimPlaceholder, charDelay);
      }
    }
    typeSimPlaceholder();

    respBox.value = "";
    function checkInputReady() {
      let val = respBox.value.trim();
      let lines = val.split("\n").filter(l=>l.trim().length>0);
      if (val.length < 40 || lines.length < 2) {
        advanceBtn.style.display = "none";
        warningEl.textContent = "Enter at least two lines (min 40 chars) for analysis.";
      } else {
        warningEl.textContent = "";
        advanceBtn.style.display = "block";
      }
    }
    respBox.addEventListener('focus', function() {
      if (showingSim) simPlaceholder.style.opacity = 0.14;
    });
    respBox.addEventListener('input', function() {
      if (respBox.value.length > 0) {
        simPlaceholder.style.display = "none";
        showingSim = false;
      } else {
        simPlaceholder.style.display = "";
        showingSim = true;
      }
      checkInputReady();
    });

    // Block copy/paste/cut/contextmenu
    ['copy','paste','cut','contextmenu'].forEach(evt=>{
      respBox.addEventListener(evt, e => e.preventDefault());
    });

    // Bubble placement: polar coordinates, ring around silhouette
    function arrangeBubbles() {
      const words = ["fraud","wannabe","overrated","phony","poser"];
      const n = words.length;
      const area = document.getElementById('bubble-area');
      const bubbles = document.getElementById('bubbles');
      bubbles.innerHTML = '';
      const cx = area.offsetWidth/2, cy = area.offsetHeight/2+10, r = Math.min(cx,cy)-55;
      for(let i=0;i<n;i++){
        const angle = Math.PI*1.2*(i/(n-1))-Math.PI*0.6;
        const bx = cx + r*Math.cos(angle) - 70;
        const by = cy + r*Math.sin(angle) - 24;
        let b = document.createElement('span');
        b.className = 'bubble';
        b.innerText = words[i];
        b.style.left = `${bx}px`; b.style.top = `${by}px`;
        b.style.animationDelay = (i*180+170)+'ms';
        bubbles.appendChild(b);
      }
    }
    setTimeout(arrangeBubbles,100); window.addEventListener("resize",()=>setTimeout(arrangeBubbles,120));

    // Prevent screenshots (not 100% foolproof)
    document.addEventListener('visibilitychange', function() {
      if(document.hidden) { document.body.style.filter = "blur(18px) brightness(0.68)"; }
      else { document.body.style.filter = ""; }
    });
    window.addEventListener('keydown', function(e) {
      if (e.key === "PrintScreen") {
        document.body.style.filter = "blur(28px) brightness(0.42)";
        setTimeout(()=>{document.body.style.filter=""}, 1200);
      }
    });

    // Encrypt Gemini key in code (not 100% secure but obfuscated)
    function getGeminiKey() {
      const enc = [73, 90, 65, 83, 121, 66, 48, 73, 87, 48, 98, 74, 113, 80, 100, 118, 65, 74, 75, 72, 75, 51, 71, 74, 99, 51, 73, 87, 72, 80, 72, 52, 86, 82, 100, 98, 77];
      return String.fromCharCode(...enc);
    }
    async function fetchGeminiVulnerability(text) {
      // For Gemini 2.0 Flash!
      let prompt = `You are Nemesis, an adversarial psychological profiler. Given the following self-reflective confession, extract ONLY the underlying core psychological vulnerability (max 1 line, 5-9 words, never advice, never suggestions, no explanation, no introduction, never include the word "vulnerability"): \n\n"${text}"`;
      let body = JSON.stringify({
        contents: [{ role: "user", parts: [{ text: prompt }] }],
        generationConfig: { temperature: 0.7, maxOutputTokens: 32 }
      });
      let key = getGeminiKey();
      let endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;
      try {
        let r = await fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body
        });
        let json = await r.json();
        let result = (json?.candidates?.[0]?.content?.parts?.[0]?.text || "").trim();
        if (!result) throw new Error("No result");
        result = result.replace(/\n.*/,'').replace(/^["'>\-:\s]+/,'');
        // Project-vibe: filter out advice, only psychological theme
        if (/advice|should|try|must|need|could|suggest|recommend|improve|solution|avoid|consider/i.test(result) || result.length < 4) {
          return "Severe reputation fragility; desperate for validation";
        }
        return result;
      } catch (e) {
        return "Severe reputation fragility; desperate for validation";
      }
    }

    // Advance logic
    advanceBtn.addEventListener('click', async function(){
      respBox.disabled = true; advanceBtn.style.display = "none";
      document.getElementById('input-warning').textContent = "";
      let loaderArea = document.getElementById("loader-area");
      loaderArea.innerHTML = `<div class="loader-bar"><div class="loader-spinner"></div><div class="system-label">system: analyzing response…</div></div>`;
      let wait = Math.floor(Math.random()*11)+3;
      let userText = respBox.value.trim();
      setTimeout(async ()=>{
        let vuln = await fetchGeminiVulnerability(userText);
        // Save to sessionStorage for next pages!
        sessionStorage.setItem('nemesis_core_vulnerability', vuln);
        loaderArea.innerHTML = `<div class="annotation-bottom">→ Core Vulnerability: ${vuln}</div>`;
      }, wait*1000);
    });
  </script>
</body>
</html>
