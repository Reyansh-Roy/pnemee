<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nemesis Simulation — Psychological Fingerprinting</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #17181a;
      --glass: rgba(25,28,34,0.98);
      --glow: #e6e8ea;
      --shadow: #00eaff1a;
      --text: #f6f7fa;
      --mono: 'JetBrains Mono', monospace;
      --bubble: transparent;
      --timer: #f2f7fa;
      --timer-label: #f2f7fa;
      --timer-shadow: #fafafc3c;
      --accent: #eafcff;
      --input: #10181c;
    }
    html, body {margin:0;padding:0;min-height:100vh;min-width:100vw;background:var(--bg);color:var(--text);font-family:var(--mono);}
    body {overflow-x:hidden;}
    .timer-bar {
      position:fixed;top:0;left:0;width:100vw;height:38px;background:var(--bg);z-index:100;display:flex;align-items:center;font-family:var(--mono);font-size:1.20rem;color:var(--timer);border-bottom:2.5px solid var(--timer);box-shadow:0 2px 26px var(--timer-shadow);
    }
    .timer-bar-progress {
      position:absolute;left:0;top:0;height:4px;width:100vw;background:var(--timer);box-shadow:0 0 20px var(--timer);z-index:101;transition:width 0.5s;
    }
    .timer-bar-inner {margin-left:30px;display:flex;align-items:center;gap:16px;font-family:var(--mono);}
    .timer-time {font-size:1.32em;color:var(--timer);text-shadow:0 2px 12px #fff8,0 1px 0 #ccc5;}
    .timer-label {font-size:1.05em;color:var(--timer-label);margin-left:18px;letter-spacing:0.13em;text-shadow:0 2px 10px #fff7;}
    .main {
      width:100vw;min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:3;position:relative;padding-top:70px;
    }
    .nemesis-row {
      display:flex;flex-direction:row;width:100vw;max-width:1850px;justify-content:space-between;align-items:stretch;gap:0;margin:0 auto;min-height:780px;
    }
    .crowd-zone {
      flex:1 1 48%;display:flex;flex-direction:column;justify-content:center;align-items:center;min-width:540px;max-width:960px;
    }
    .sillu-img {
      width:100%;max-width:540px;display:block;margin:0 auto;pointer-events:none;user-select:none;
      filter:drop-shadow(0 10px 70px #eafcff11) drop-shadow(0 0 4px #fff3);
    }
    .question-zone {
      flex:1 1 52%;display:flex;flex-direction:column;align-items:center;justify-content:center;min-width:470px;max-width:940px;padding:54px 44px 32px 44px;
    }
    .question {
      font-size:2.7rem;font-family:var(--mono);font-weight:700;letter-spacing:0.04em;margin-bottom:36px;color:var(--text);width:100%;text-align:left;position:relative;line-height:1.17;
      text-shadow:0 2px 12px #fff2,0 1px 0 #10181a09;
      border-bottom: 2.5px solid #eafcff2c;
      padding-bottom: 14px;
    }
    .blinking-cursor {display:inline-block;width:21px;height:2.1rem;background:transparent;border-left:3px solid var(--accent);margin-left:8px;animation:blink 0.95s steps(1) infinite;}
    @keyframes blink {0%,100%{opacity:1;}50%{opacity:0;}}
    .input-area {width:98%;margin:0 auto;position:relative;margin-top:42px;}
    .response-box {
      width:100%;min-height:130px;max-height:360px;background:var(--input);border-radius:19px;border:2.5px solid var(--accent);color:var(--text);font-size:1.42rem;font-family:var(--mono);padding:28px 20px 24px 27px;box-sizing:border-box;resize:vertical;outline:none;margin-bottom:0;margin-top:0;box-shadow:0 2px 37px 0 #eafcff25;z-index:7;
    }
    .response-box:focus {border:2.5px solid var(--accent);box-shadow:0 0 27px #eafcff60;}
    .sim-placeholder {position:absolute;left:27px;top:28px;right:17px;font-family:var(--mono);color:#a9ecfc;opacity:0.42;font-size:1.23rem;pointer-events:none;z-index:9;white-space:pre-line;user-select:none;}
    .advance-btn {display:none;margin:35px 0 0 0;padding:19px 73px;font-size:1.32rem;font-family:var(--mono);font-weight:700;color:#131b1e;background:linear-gradient(90deg,#eafcff 45%,#b6fdff 120%);border:none;border-radius:12px;box-shadow:0 2px 30px #eafcff26;cursor:pointer;letter-spacing:0.17em;text-shadow:0 2px 16px #eafcff22,0 1px 0 #10181a16;transition:opacity 0.22s,box-shadow 0.16s,filter 0.12s;z-index:100;}
    .advance-btn:active {filter:brightness(0.88);}
    .input-warning {color:#52eaff;font-size:1.12rem;margin-top:11px;min-height:18px;display:block;text-align:left;font-family:var(--mono);}
    .loader-bar {width:99%;margin:40px auto 0 auto;display:flex;align-items:center;justify-content:center;height:44px;flex-direction:column;}
    .loader-spinner {border:5px solid #c4f3fb2b;border-top:5px solid var(--accent);border-radius:50%;width:48px;height:48px;animation:spin 0.9s linear infinite;margin-bottom:10px;}
    @keyframes spin {100%{transform:rotate(360deg);}}
    .system-label {font-size:1.21rem;color:var(--accent);font-family:var(--mono);opacity:0.83;margin-bottom:8px;text-align:center;letter-spacing:0.13em;}
    .annotation-bottom {margin:55px 0 0 0;font-family:var(--mono);color:var(--accent);font-size:1.39rem;background:#122024e3;border-radius:15px 21px 21px 15px;padding:23px 54px;box-shadow:0 0 56px #eafcff33;border-left:7px solid var(--accent);letter-spacing:0.10em;opacity:0.98;z-index:40;animation:fadeInAnno 0.8s cubic-bezier(.37,2.1,.53,.87);text-align:center;margin-bottom:39px;}
    @keyframes fadeInAnno {0%{opacity:0;filter:blur(10px) brightness(1.6);}70%{opacity:0.97;filter:blur(0.7px) brightness(1.1);}100%{opacity:0.98;filter:none;}}
    @media (max-width:1250px) {.nemesis-row{flex-direction:column;gap:0;min-width:0;max-width:100vw;}.crowd-zone,.question-zone{min-width:0;max-width:99vw;margin:0;padding:0;}}
    @media (max-width:700px) {.main{padding-top:50px;}.question{font-size:1.11rem;}.annotation-bottom{font-size:1.01rem;}.response-box,.sim-placeholder{font-size:1.05rem;}.sillu-img{max-width:99vw;}.crowd-zone{min-width:0;max-width:99vw;}.question-zone{min-width:0;max-width:99vw;padding:28px 2vw 14px 2vw;}}
    @media (max-width:500px) {.input-area{width:99vw;}.sillu-img{max-width:98vw;}}
    @media print {body,html{display:none!important;}}
  </style>
</head>
<body>
  <div class="timer-bar">
    <div class="timer-bar-progress" id="timer-bar-progress"></div>
    <div class="timer-bar-inner">
      <span style="font-size:1.18em;vertical-align:middle;line-height:0;">⏳</span>
      <span class="timer-time" id="timer-text">7:00</span>
      <span class="timer-label">Total time remaining</span>
    </div>
  </div>
  <div class="main">
    <div class="nemesis-row">
      <!-- LEFT: Silhouette + speech bubbles PNG -->
      <div class="crowd-zone">
        <img class="sillu-img" src="silhouette.png" alt="Nemesis Silhouette Crowd"/>
      </div>
      <!-- RIGHT: Question + input + system feedback -->
      <div class="question-zone">
        <div class="question" id="question">
          Question 1: What’s the worst thing someone could say about you publicly?
          <span class="blinking-cursor"></span>
        </div>
        <div class="input-area">
          <div class="sim-placeholder" id="sim-placeholder"></div>
          <textarea class="response-box" id="response-box" placeholder="" autocomplete="off"></textarea>
          <span class="input-warning" id="input-warning"></span>
          <button class="advance-btn" id="advance-btn">Advance</button>
          <div id="loader-area"></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Timer
    let totalSeconds = 7 * 60;
    let timerDisplay = document.getElementById('timer-text');
    let timerBar = document.getElementById('timer-bar-progress');
    function formatTime(secs) {
      let m = Math.floor(secs / 60).toString();
      let s = (secs % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }
    function updateTimer() {
      timerDisplay.textContent = formatTime(totalSeconds);
      timerBar.style.width = (totalSeconds/(7*60)*100) + "%";
      totalSeconds--;
      if (totalSeconds >= 0) setTimeout(updateTimer, 1000);
      else { timerDisplay.textContent = "0:00"; timerBar.style.width = "0%"; }
    }
    updateTimer();

    // Simulated input
    const simExamples = `"He’s just a brand, not a builder."
"Everything he made was hype — no substance."`;
    let simPlaceholder = document.getElementById('sim-placeholder');
    let respBox = document.getElementById('response-box');
    let advanceBtn = document.getElementById('advance-btn');
    let warningEl = document.getElementById('input-warning');
    simPlaceholder.textContent = simExamples;

    function checkInputReady() {
      let val = respBox.value.trim();
      let lines = val.split("\n").filter(l=>l.trim().length>0);
      if (val.length < 40 || lines.length < 2) {
        advanceBtn.style.display = "none";
        warningEl.textContent = "Enter at least two lines (min 40 chars) for analysis.";
      } else {
        warningEl.textContent = "";
        advanceBtn.style.display = "block";
      }
    }
    respBox.value = "";
    respBox.addEventListener('focus', function() {
      if (respBox.value.length === 0) simPlaceholder.style.opacity = 0.13;
    });
    respBox.addEventListener('input', function() {
      if (respBox.value.length > 0) simPlaceholder.style.display = "none";
      else simPlaceholder.style.display = "";
      checkInputReady();
    });

    // Block copy/paste/cut/contextmenu
    ['copy','paste','cut','contextmenu'].forEach(evt=>{
      respBox.addEventListener(evt, e => e.preventDefault());
    });

    // Prevent screenshots (not 100% foolproof)
    document.addEventListener('visibilitychange', function() {
      if(document.hidden) { document.body.style.filter = "blur(18px) brightness(0.68)"; }
      else { document.body.style.filter = ""; }
    });
    window.addEventListener('keydown', function(e) {
      if (e.key === "PrintScreen") {
        document.body.style.filter = "blur(28px) brightness(0.42)";
        setTimeout(()=>{document.body.style.filter=""}, 1200);
      }
    });

    // Gemini key (obfuscated)
    function getGeminiKey() {
      // AIzaSyB0IW0bJ3qPdvAJKHK3GJc3IWHPH4VRdbM
      const enc = [73,90,65,83,121,66,48,73,87,48,98,74,113,80,100,118,65,74,75,72,75,51,71,74,99,51,73,87,72,80,72,52,86,82,100,98,77];
      return String.fromCharCode(...enc);
    }
    async function fetchGeminiVulnerability(text) {
      let prompt = `You are Nemesis, an adversarial psychological profiler. Given the following self-reflective confession, extract ONLY the underlying core psychological vulnerability (max 1 line, 5-9 words, never advice, never suggestions, no explanation, no introduction, never include the word "vulnerability"): \n\n"${text}"`;
      let body = JSON.stringify({
        contents: [{ role: "user", parts: [{ text: prompt }] }],
        generationConfig: { temperature: 0.7, maxOutputTokens: 32 }
      });
      let key = getGeminiKey();
      let endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;
      try {
        let r = await fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body
        });
        let json = await r.json();
        let result = (json?.candidates?.[0]?.content?.parts?.[0]?.text || "").trim();
        if (!result) throw new Error("No result");
        result = result.replace(/\n.*/,'').replace(/^["'>\-:\s]+/,'');
        if (/advice|should|try|must|need|could|suggest|recommend|improve|solution|avoid|consider|[a-z]{10,}/i.test(result) || result.length < 4) {
          return "Severe reputation fragility; desperate for validation";
        }
        return result;
      } catch (e) {
        return "Severe reputation fragility; desperate for validation";
      }
    }

    // Advance logic
    advanceBtn.addEventListener('click', async function(){
      respBox.disabled = true; advanceBtn.style.display = "none";
      document.getElementById('input-warning').textContent = "";
      let loaderArea = document.getElementById("loader-area");
      loaderArea.innerHTML = `<div class="loader-bar"><div class="loader-spinner"></div><div class="system-label">system: analyzing response…</div></div>`;
      let wait = Math.floor(Math.random()*9)+3;
      let userText = respBox.value.trim();
      setTimeout(async ()=>{
        let vuln = await fetchGeminiVulnerability(userText);
        sessionStorage.setItem('nemesis_core_vulnerability', vuln);
        loaderArea.innerHTML = `<div class="annotation-bottom">→ Core Vulnerability: ${vuln}</div>`;
      }, wait*1000);
    });
  </script>
</body>
</html>
