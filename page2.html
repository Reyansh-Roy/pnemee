<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Initiation Protocol: Psychological Fingerprinting</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    /* === RESET & FONTS === */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #0a0a0b 0%, #141317 100%);
      color: #f8f9fb;
      font-family: 'JetBrains Mono', 'Fira Mono', monospace;
      font-weight: 500;
      letter-spacing: 0.01em;
      min-height: 100vh;
      width: 100vw;
      overflow: hidden;
      user-select: none;
    }
    @font-face {
      font-family: 'JetBrains Mono';
      src: local('JetBrains Mono'), local('Fira Mono'), monospace;
    }

    /* === SECURITY: BLOCK SELECTION/COPY/CONTEXT === */
    body, input, textarea, button {
      -webkit-user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      caret-color: #f8f9fb;
    }
    ::selection { background: none; }
    body::-webkit-scrollbar { display: none; }

    /* === SECURITY: BLOCK SCROLL === */
    html, body { overflow: hidden !important; }

    /* === SECURITY: BLOCK CONTEXT MENU === */
    body { pointer-events: auto; }

    /* === BLOCK MOBILE === */
    #mobile-block {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 99999;
      background: #0a0a0b;
      color: #fff;
      font-family: 'JetBrains Mono', monospace;
      font-size: 2.2vw;
      letter-spacing: 0.01em;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    /* === HEADER / TIMER === */
    .header {
      width: 100vw;
      text-align: center;
      font-size: 1.25rem;
      font-weight: 600;
      letter-spacing: 0.01em;
      margin-top: 2.2vh;
      color: #ececf0;
      text-shadow: 0 0 6px #16181b70;
    }
    .timer {
      position: absolute;
      top: 2.2vh;
      right: 3vw;
      font-size: 1.1rem;
      font-family: inherit;
      letter-spacing: 0.04em;
      color: #e7e9ed;
      border: 1px solid #232427;
      border-radius: 6px;
      padding: 3px 18px;
      background: rgba(13,13,14,0.55);
      box-shadow: 0 0 10px 1px #181a1e20;
      text-align: right;
      min-width: 82px;
      transition: border 0.2s;
    }

    /* === MAIN WRAPPER === */
    .main {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 89vh;
      width: 100vw;
      padding-bottom: 30px;
      position: relative;
    }

    /* === SILHOUETTE === */
    .silhouette-wrap {
      margin-top: 1.2vh;
      margin-bottom: 2.5vh;
      position: relative;
      z-index: 2;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .silhouette-bg-matrix {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 1;
      opacity: 0.27;
      filter: blur(0.7px);
    }
    .silhouette-img {
      max-width: 265px;
      max-height: 38vh;
      min-width: 170px;
      min-height: 150px;
      border-radius: 2vw;
      filter: drop-shadow(0 0 38px #17172588) blur(0.7px);
      box-shadow: 0 0 35px #1b122d44;
      z-index: 2;
      background: #0a0a0b;
      object-fit: contain;
      user-drag: none;
      pointer-events: none;
    }

    /* === QUESTION === */
    .question {
      font-size: 1.18rem;
      color: #fafbfc;
      font-family: inherit;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-align: center;
      margin-bottom: 2.2vh;
      margin-top: 0.5vh;
      text-shadow: 0 0 5px #18181e45;
      transition: color 0.12s;
    }

    /* === INPUT === */
    .input-area {
      width: 100%;
      max-width: 500px;
      min-width: 220px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    textarea {
      font-family: 'JetBrains Mono', 'Fira Mono', monospace;
      width: 100%;
      min-height: 90px;
      max-height: 150px;
      background: #111217;
      border: 1.3px solid #232227;
      border-radius: 8px;
      color: #f8f9fb;
      font-size: 1rem;
      font-weight: 500;
      padding: 18px 20px 18px 20px;
      resize: none;
      box-shadow: 0 0 8px #23243318;
      transition: border 0.2s, box-shadow 0.2s;
      outline: none;
      caret-color: #f8f9fb;
      letter-spacing: 0.02em;
      margin-bottom: 22px;
      z-index: 3;
      opacity: 1;
      position: relative;
    }
    textarea:focus {
      border: 1.3px solid #bdbcf6;
      box-shadow: 0 0 10px #9b9cf720;
    }
    textarea.disabled, textarea:disabled {
      background: #171821;
      color: #999;
      border: 1.2px solid #dd344490;
      cursor: not-allowed;
    }
    .ghost-text {
      position: absolute;
      top: 19px;
      left: 26px;
      color: #7e808d;
      opacity: 0.6;
      pointer-events: none;
      font-size: 1rem;
      white-space: pre-line;
      font-family: inherit;
      user-select: none;
      z-index: 4;
      transition: opacity 0.23s, filter 0.19s;
      filter: blur(0.2px);
      text-shadow: 0 0 1.5px #1a1b2055;
      animation: ghostin 1.2s;
    }
    @keyframes ghostin {
      0% { opacity: 0; filter: blur(2px);}
      100% { opacity: 0.6; filter: blur(0.2px);}
    }
    .ghost-glitch {
      animation: ghostglitch 0.28s;
    }
    @keyframes ghostglitch {
      0% { opacity: 0.6; filter: blur(0.2px);}
      55% { opacity: 0.15; filter: blur(2.8px);}
      80% { opacity: 0.45; filter: blur(0.7px);}
      100% { opacity: 0; filter: blur(0.1px);}
    }

    /* === BUTTONS === */
    .btn {
      display: block;
      width: 100%;
      max-width: 390px;
      margin: 0 auto;
      margin-bottom: 12px;
      padding: 15px 0;
      background: #232227;
      color: #fafbfc;
      font-family: inherit;
      font-size: 1.1rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      border: none;
      border-radius: 8px;
      box-shadow: 0 0 15px #17172715;
      cursor: pointer;
      transition: border 0.18s, background 0.18s, color 0.16s;
      outline: none;
      position: relative;
    }
    .btn:focus {
      border: 1.7px solid #e0e0ef88;
    }
    .btn:hover:enabled {
      border: 1.3px solid #bdbcf6;
      background: #23232d;
      color: #f7f8ff;
    }
    .btn:disabled, .btn.disabled {
      opacity: 0.52;
      cursor: not-allowed;
    }
    .btn.sharper {
      border-radius: 5px;
      font-size: 1.08rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      box-shadow: 0 0 7px #1a1a2313;
    }

    /* === PROCESSING STATE === */
    .processing-row {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 22px;
      gap: 14px;
    }
    .gear {
      width: 24px;
      height: 24px;
      animation: spin 0.88s linear infinite;
      opacity: 0.77;
      filter: grayscale(1) brightness(1.13);
      margin-right: 8px;
    }
    @keyframes spin {
      0% { transform: rotate(0);}
      100% { transform: rotate(360deg);}
    }
    .processing-txt {
      font-size: 0.99rem;
      color: #f3f3f8;
      font-family: inherit;
      letter-spacing: 0.025em;
      font-weight: 500;
      opacity: 0.88;
      margin-left: 1px;
      user-select: none;
    }

    /* === VULNERABILITY REVEAL === */
    .vulnerability {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      width: 98%;
      max-width: 430px;
      margin: 28px auto 8px auto;
      padding: 12px 18px 12px 24px;
      background: #101012ef;
      border-left: 3.5px solid #f7f7fb;
      border-radius: 8px;
      box-shadow: 0 2px 22px #10101515;
      font-family: inherit;
      font-size: 1.08rem;
      font-weight: 600;
      color: #f7f7fb;
      letter-spacing: 0.01em;
      opacity: 0;
      pointer-events: none;
      transform: translateY(18px);
      transition: opacity 0.23s, transform 0.25s;
      z-index: 10;
    }
    .vulnerability.visible {
      opacity: 0.93;
      pointer-events: auto;
      transform: translateY(0);
      animation: scanline 0.9s linear;
    }
    @keyframes scanline {
      0% { filter: brightness(0.6) blur(1.8px);}
      85% { filter: brightness(1.04) blur(0);}
      100% { filter: brightness(1.18) blur(0);}
    }

    /* === NEXT BUTTON === */
    .btn.next {
      margin-top: 15px;
      background: #232227;
      border: 1.7px solid #fafbfc40;
      color: #fafbfc;
      border-radius: 5px;
      font-weight: 700;
      letter-spacing: 0.08em;
      font-size: 1.08rem;
      box-shadow: 0 0 10px #18182518;
      transition: border 0.16s, color 0.16s, background 0.16s;
    }
    .btn.next:hover:enabled {
      border: 1.7px solid #eaeaea99;
      color: #ffffff;
      background: #232237;
    }

    /* === SECURITY: BLOCK BACK NAV === */
    #back-block {
      display: none;
    }
  </style>
</head>
<body>
  <div id="mobile-block">
    <div>
      This simulation is only accessible on desktop and tablet.<br>
      <span style="font-size: 1.3vw;opacity:.5;display:block;margin-top:15px;">Project Nemesis Initiation Protocol</span>
    </div>
  </div>

  <div id="back-block"></div>
  <div class="header">Question 1: What’s the worst thing someone could say about you publicly?</div>
  <div class="timer" id="timer">07:00</div>
  <div class="main">
    <div class="silhouette-wrap">
      <!-- Simulated matrix static effect using canvas -->
      <canvas class="silhouette-bg-matrix" id="matrix-canvas"></canvas>
      <img src="silhouette.png" alt="Silhouette" class="silhouette-img" draggable="false" />
    </div>

    <div class="input-area" style="position:relative;">
      <textarea id="inputBox" maxlength="300" autocomplete="off" spellcheck="false" rows="3" aria-label="Reveal your core vulnerability"></textarea>
      <div id="ghostText" class="ghost-text"></div>
      <button class="btn" id="revealBtn">REVEAL VULNERABILITY</button>
    </div>

    <div class="processing-row" id="processingRow" style="display:none;">
      <svg class="gear" viewBox="0 0 32 32" fill="none">
        <g>
          <circle cx="16" cy="16" r="11.5" stroke="#f7f7fb" stroke-width="2" opacity="0.65"/>
          <path d="M16 4V2M16 30v-2M4 16H2m28 0h-2M8.22 8.22l-1.41-1.41m18.38 18.38-1.41-1.41M8.22 23.78l-1.41 1.41m18.38-18.38-1.41 1.41" stroke="#f7f7fb" stroke-width="2" stroke-linecap="round"/>
        </g>
      </svg>
      <span class="processing-txt">Processing...</span>
    </div>

    <div class="vulnerability" id="vulnerabilityBox">
      &rarr; Core Vulnerability: <span style="margin-left:8px;">Reputation Fragility</span>
    </div>
    <button class="btn next sharper" id="nextBtn" style="display:none;">ADVANCE TO NEXT ADVERSARY TRIAL</button>
  </div>

  <script>
    // ======== MOBILE BLOCKER ========
    function isMobile() {
      return (window.innerWidth < 600) || /Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }
    function showMobileBlock() {
      document.getElementById('mobile-block').style.display = 'flex';
      document.body.style.overflow = 'hidden';
      document.querySelectorAll('body > *:not(#mobile-block)').forEach(el => { if (el.id !== "mobile-block") el.style.display = "none"; });
    }
    if (isMobile()) showMobileBlock();
    window.addEventListener('resize', () => { if (isMobile()) showMobileBlock(); });

    // ======== SECURITY: BLOCK CONTEXT MENU, COPY, PASTE, PRINTSCREEN ========
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('copy', e => e.preventDefault());
    document.addEventListener('cut', e => e.preventDefault());
    document.addEventListener('paste', e => e.preventDefault());
    document.addEventListener('keydown', function(e) {
      // Block Print Screen, Ctrl+P, Ctrl+S, Ctrl+U, Ctrl+C/V/X
      if (e.key === "PrintScreen" ||
        ((e.ctrlKey || e.metaKey) && ['p','s','u','c','v','x','a'].includes(e.key.toLowerCase()))
      ) { e.preventDefault(); }
      // Block back navigation
      if (e.key === "Backspace" && !["INPUT", "TEXTAREA"].includes(document.activeElement.tagName)) e.preventDefault();
    });

    // ======== SECURITY: BLOCK NAVIGATION / BACK ========
    history.pushState(null, null, location.href);
    window.onpopstate = function() {
      history.pushState(null, null, location.href);
      document.getElementById('back-block').style.display = 'block';
      setTimeout(() => {document.getElementById('back-block').style.display = 'none';}, 4000);
    };

    // ======== TIMER ========
    let time = 420; // 7 minutes
    let timerInt = setInterval(updateTimer, 1000);
    let timerPaused = false;
    function updateTimer() {
      if (timerPaused) return;
      if (time <= 0) return;
      time--;
      let min = String(Math.floor(time / 60)).padStart(2, '0');
      let sec = String(time % 60).padStart(2, '0');
      document.getElementById('timer').textContent = `${min}:${sec}`;
    }

    // ======== GHOST TEXT LOGIC ========
    const inputBox = document.getElementById('inputBox');
    const ghostText = document.getElementById('ghostText');
    const ghostContent = `He’s just a brand, not a builder.\nEverything he made was hype — no substance.`;

    function showGhost() {
      ghostText.textContent = ghostContent;
      ghostText.style.opacity = 0.6;
      ghostText.classList.remove('ghost-glitch');
    }
    function hideGhost() {
      ghostText.classList.add('ghost-glitch');
      setTimeout(() => { ghostText.style.opacity = 0; }, 130);
    }
    inputBox.addEventListener('focus', () => {
      if (!inputBox.value) hideGhost();
    });
    inputBox.addEventListener('blur', () => {
      if (!inputBox.value) showGhost();
    });
    inputBox.addEventListener('input', () => {
      if (inputBox.value.length) {
        hideGhost();
      } else {
        showGhost();
      }
    });

    // ======== INITIAL GHOST LOAD ========
    showGhost();

    // ======== BUTTON INTERACTION ========
    const revealBtn = document.getElementById('revealBtn');
    const processingRow = document.getElementById('processingRow');
    const vulnerabilityBox = document.getElementById('vulnerabilityBox');
    const nextBtn = document.getElementById('nextBtn');

    let processed = false;
    revealBtn.onclick = function() {
      if (processed) return;
      inputBox.disabled = true;
      inputBox.classList.add('disabled');
      revealBtn.disabled = true;
      revealBtn.classList.add('disabled');
      processingRow.style.display = 'flex';
      inputBox.style.border = "1.4px solid #e0e1e9";
      timerPaused = true;
      // Random delay (4–12s)
      let delay = 4000 + Math.floor(Math.random()*8000);
      setTimeout(() => {
        processingRow.style.display = 'none';
        vulnerabilityBox.classList.add('visible');
        nextBtn.style.display = 'block';
        processed = true;
      }, delay);
    };

    // ======== NEXT BUTTON LOGIC ========
    nextBtn.onclick = () => { window.location.href = 'page3.html'; };

    // ======== GHOST TEXT INITIAL POSITIONING ========
    function updateGhostPos() {
      // Ensure ghost text matches textarea font
      const rect = inputBox.getBoundingClientRect();
      ghostText.style.width = rect.width + 'px';
      ghostText.style.height = rect.height + 'px';
    }
    setTimeout(updateGhostPos, 200);
    window.addEventListener('resize', updateGhostPos);

    // ======== MATRIX STATIC CANVAS ========
    function matrixStatic(canvas) {
      let ctx = canvas.getContext('2d');
      let w = canvas.width = 260;
      let h = canvas.height = 185;
      function draw() {
        ctx.clearRect(0, 0, w, h);
        for (let i = 0; i < 30; i++) {
          let x = Math.random() * w;
          let y = Math.random() * h;
          let len = Math.random() * 14 + 8;
          ctx.globalAlpha = 0.08 + Math.random()*0.08;
          ctx.strokeStyle = Math.random() > 0.96 ? '#aaa9dd' : '#323043';
          ctx.beginPath();
          ctx.moveTo(x, y);
          ctx.lineTo(x, y+len);
          ctx.stroke();
        }
        ctx.globalAlpha = 1;
      }
      setInterval(draw, 200);
    }
    setTimeout(() => {
      const canvas = document.getElementById('matrix-canvas');
      if (canvas) matrixStatic(canvas);
    }, 500);

    // ======== NO STATE SAVED ON REFRESH ========
    window.onbeforeunload = function(){ return undefined; };
  </script>
</body>
</html>
